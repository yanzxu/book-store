#!groovy

pipeline {
    // agent {
    //     node {
    //         label 'node02'
    //     }
    // }

    agent any

    stages {
        stage('checkout') {
            // 1. add git config in jenkins;
            // 2. when build in new node, should add ssh key in github;
            steps {
                echo '********* checkout start ********'
                echo pwd()
                git branch:'dev-test-service',credentialsId:'aaa16faa-d48c-49a3-ad3d-9497ce08fee0',url:'git@github.com:yanzxu/book-store.git'
                echo '********* checkout end ********'
            }
        }
        
        stage('buildJar') {
            steps {
                echo '********* buildJar start ********'
                sh './gradlew clean :user-service:bootJar'
                echo '********* buildJar start ********'
            }
        }

        stage('buildImage') {
            // note the difference between '' and "";
            steps {
                dir('user-service') {
                    echo '********* buildImage start ********'
                    echo pwd()
                    sh "docker build -t user-service:${env.BUILD_ID} ."
                    echo '********* buildImage end ********'
                }
            }

        }
    }
}
